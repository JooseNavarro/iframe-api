<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8">
<title>iframe api</title>
</head>
<body>
    <h2>iframe api</h2>
    <p>This page includes another website using iframe. This page (let us call it <em>external</em> page) can communicate
    with the website inside the iframe using an API object</p>

    <button id="btn" style="display:none">Call iframe API method</button>

    <script src="utils/log-to.js"></script>
    <script src="src/external-api.js"></script>

    <script>
    (function iframeApiHandshake() {

      var myMethods = {
        foo: function (arg) {
          console.log('myMethods.foo called wtih argument', arg);
          this.baz();
        },
        baz: function () {
          console.log('myMethods.baz()');
        }
      };

      iframeApi(myMethods, function (err, api) {
        if (err) {
          throw new Error('iframeApi error ' + err);
        }
        console.log('received api from iframe');
        console.log('api methods:', Object.keys(api));

        var btn = document.getElementById('btn');
        btn.addEventListener('click', function () {
          console.log('button clicked, calling method via iframe api');
          api.bar('hi from external site');
        });
        btn.style.display = '';
      });
    }());
    </script>

    <iframe id="page" src="test/page.html" width="100%" height="500"></iframe>
    <!--
    <iframe id="page" src="http://localhost:3003/test/page.html" width="100%" height="500"></iframe>
    -->

</body>
</html>
