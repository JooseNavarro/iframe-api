<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <title>iframe api</title>
  <script src="bower_components/es5-shim/es5-shim.js"></script>
</head>
<body>
    <h2>iframe api</h2>
    <p>This page includes another website using iframe. This page (let us call it <em>external</em> page) can communicate
    with the website inside the iframe using an API object</p>

    <button id="btn" style="display:none">Call iframe API method</button>

    <script src="utils/log-to.js"></script>

    <script src="dist/external-api.js"></script>

    <script>
    (function iframeApiHandshake(iframeApi) {

      if (typeof iframeApi !== 'function') {
        throw new Error('Missing iframeApi function');
      }

      var myMethods = {
        foo: function (arg) {
          console.log('myMethods.foo called wtih argument', arg);
          this.baz();
        },
        baz: function () {
          console.log('myMethods.baz()');
        },
        version: '1.0.0'
      };

      var options = {
        // true - verify received md5 against decalred.
        // string - compute and compare md5 to the given string
        md5: true
      };

      function connected(err, api) {
        if (err) {
          throw new Error('iframeApi error ' + err);
        }
        console.log('received api from iframe with version', api.version);
        console.log('api methods:', Object.keys(api));

        var btn = document.getElementById('btn');
        btn.addEventListener('click', function () {
          console.log('button clicked, calling method via iframe api');
          api.bar('hi from external site');
        });
        btn.style.display = '';
      }

      iframeApi(myMethods, connected, options);
    }(window.iframeApi));
    </script>

    <iframe id="page" src="test/page.html" width="100%" height="500"></iframe>
    <!--
    <iframe id="page" src="http://localhost:3003/test/page.html" width="100%" height="500"></iframe>
    -->

</body>
</html>
